<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>News Base</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #e0f7fa, #fffde7);
      color: #333;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.8em;
      color: #2c3e50;
    }
    #searchBar {
      width: 92%;
      padding: 12px 16px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 30px;
      margin: 0 auto 30px;
      display: block;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    #newsList {
      display: flex;
      flex-direction: column;
      gap: 20px;
      flex-grow: 1;
    }
    .news-card {
      padding: 0;
      border: 1px solid #ddd;
      border-radius: 12px;
      background: white;
      transition: transform 0.2s;
      overflow: hidden;
      height: 365px;
    }
    .news-card:hover {
      transform: translateY(-3px);
    }
    .news-card iframe {
      border-radius: 12px;
      width: 100%;
      height: 100%;
      border: none;
      display: block;
    }
    #nextButton {
      display: block;
      margin: 40px auto 20px;
      padding: 12px 28px;
      font-size: 16px;
      background: #6f42c1;
      color: white;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: background 0.3s;
    }
    #nextButton:hover:not(:disabled) {
      background: #5936a3;
    }
    #nextButton:disabled {
      background: #a99fd1;
      cursor: not-allowed;
    }
    footer {
      text-align: center;
      padding: 20px 0;
      font-size: 0.9em;
      color: #555;
      margin-top: auto;
    }
  </style>
</head>
<body>

  <h1>Welcome to News Base</h1>
  <input type="text" id="searchBar" placeholder="Search by number or title..." />

  <div id="newsList"></div>

  <button id="nextButton">Next</button>

  <footer>
    &copy; 2025 News Base. All rights reserved.
  </footer>

  <script>
    const maxCardsPerBatch = 20;
    let allNewsCards = [];
    let allTitles = {};  // { 1: "About News Solved", 2: "text how saved" }
    let currentBatch = 0;

    async function fetchTitles() {
      const txtUrl = 'https://raw.githubusercontent.com/newsbase/itc/main/Searchable.txt';
      try {
        const res = await fetch(txtUrl);
        const text = await res.text();
        const lines = text.split('\n');

        lines.forEach(line => {
          const match = line.match(/news(\d+)\s*=\s*(.+)/);
          if (match) {
            const id = match[1];
            const title = match[2];
            allTitles[id] = title;
          }
        });
      } catch (err) {
        console.error('Failed to fetch Searchable.txt:', err);
      }
    }

    async function checkNewsExists(id) {
      const url = `https://newsbase.github.io/itc/news/news${id}.html`;
      try {
        const res = await fetch(url, { method: 'HEAD' });
        return res.ok;
      } catch {
        return false;
      }
    }

    async function loadAllNews() {
      let id = 1;
      const tempCards = [];

      while (true) {
        const exists = await checkNewsExists(id);
        if (!exists) break;

        const url = `https://newsbase.github.io/itc/news/news${id}.html`;
        const card = document.createElement('div');
        card.className = 'news-card';
        card.dataset.newsId = id;
        card.dataset.newsTitle = (allTitles[id] || '').toLowerCase();
        card.innerHTML = `<iframe src="${url}" width="100%" height="365" style="border:none;"></iframe>`;

        tempCards.push(card);
        id++;
      }

      // Sort descending by newsId
      tempCards.sort((a, b) => parseInt(b.dataset.newsId) - parseInt(a.dataset.newsId));

      allNewsCards = tempCards;
    }

    function showBatch(batchIndex) {
      const list = document.getElementById('newsList');
      list.innerHTML = '';

      const start = batchIndex * maxCardsPerBatch;
      const end = start + maxCardsPerBatch;

      const batch = allNewsCards.slice(start, end);

      batch.forEach(card => {
        card.style.display = '';
        list.appendChild(card);
      });

      updateNextButton(end < allNewsCards.length);
    }

    function updateNextButton(hasMore) {
      const btn = document.getElementById('nextButton');
      if (hasMore) {
        btn.disabled = false;
        btn.textContent = "Next";
      } else {
        btn.disabled = true;
        btn.textContent = "No More News";
      }
    }

    function setupSearch() {
      const searchInput = document.getElementById('searchBar');
      searchInput.addEventListener('input', function () {
        const query = this.value.trim().toLowerCase();

        const list = document.getElementById('newsList');
        const cards = list.children;

        for (let card of cards) {
          const newsId = card.dataset.newsId;
          const newsTitle = card.dataset.newsTitle;

          if (newsId.includes(query) || newsTitle.includes(query)) {
            card.style.display = '';
          } else {
            card.style.display = 'none';
          }
        }
      });
    }

    document.getElementById('nextButton').addEventListener('click', () => {
      currentBatch++;
      showBatch(currentBatch);
    });

    window.addEventListener('DOMContentLoaded', async () => {
      await fetchTitles();         // load Searchable.txt
      await loadAllNews();         // build cards with titles
      showBatch(currentBatch);     // show first batch
      setupSearch();               // hook up search
    });
  </script>

</body>
</html>
